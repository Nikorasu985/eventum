<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crear Evento - Eventum</title>
  <link rel="stylesheet" href="./css/crearEvento.css">
  <link rel="stylesheet" href="assets/icons/css/all.css" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
</head>

<body>

  <header>
    <a href="dashboard.html" class="logo">
      <img src="assets/logo.png" alt="Eventum Logo" />
      <h1 class="eventum">Eventum</h1>
    </a>

    <div class="options">
      <div class="notifications-icon">
        <i class="fa-solid fa-bell"></i>
      </div>
      <div class="user">
        <img src="assets/pfp-placeholder.jpeg" alt="" />
        <h2>Nikorasu985</h2>
      </div>
      <div class="sidebar-icon">
        <i class="fa-solid fa-bars"></i>
      </div>
    </div>
  </header>

  <main>


    <div class="form-container">
      <form>

        <div class="form-content">
          <div class="form-column">
            <!-- Portada -->
            <div class="form-group portada-container">
              <label for="portada">Portada</label>
              <img id="previewFinal" style="max-width:500px; display:none; border:2px solid #ccc; border-radius:8px;" />
              <input type="file" name="portada" id="portada" accept="image/jpeg, image/png">

              <!-- Contenedor del recorte -->
              <div id="cropperContainer" style="display:none; max-width:400px;">
                <img id="cropperImagen" style="max-width:100%;" />
                <button type="button" id="btnRecortar">Recortar</button>
              </div>
            </div>

            <!-- Título -->
            <div class="form-group">
              <label for="titulo">Título</label>
              <input type="text" name="titulo" id="titulo" placeholder="Título">
            </div>

            <!-- Descripción -->
            <div class="form-group">
              <label for="descripcion">Descripción</label>
              <textarea name="" id="" rows="5"></textarea>
            </div>
          </div>

          <div class="form-column">
            <!-- Lugar -->
            <div class="form-group">
              <label for="lugar">Lugar</label>
              <input type="text" name="lugar" id="lugar" placeholder="Lugar">
            </div>

            <!-- Dirección -->
            <div class="form-group">
              <label for="direccion">Dirección</label>
              <input type="text" name="direccion" id="direccion" placeholder="Dirección">
            </div>

            <!-- Fecha inicio -->
            <div class="form-group">
              <label for="fecha_inicio">Fecha de inicio</label>
              <input type="datetime-local" name="fecha_inicio" id="fecha_inicio">
            </div>

            <!-- Fecha fin -->
            <div class="form-group">
              <label for="fecha_fin">Fecha de fin</label>
              <input type="datetime-local" name="fecha_fin" id="fecha_fin">
            </div>

            <!-- Tipo de presupuesto -->
            <div class="form-group">
              <label for="tipo_presupuesto">Tipo de presupuesto</label>
              <select name="tipo_presupuesto" id="tipo_presupuesto">
                <option value="sugerido">Sugerido</option>
                <option value="fijo">Fijo</option>
              </select>
            </div>

            <!-- Presupuesto -->
            <div class="form-group">
              <label for="presupuesto">Presupuesto</label>
              <input type="number" name="presupuesto" id="presupuesto">
            </div>

            <!-- Número de integrantes -->
            <div class="form-group">
              <label for="numero_integrantes">Número de integrantes</label>
              <input type="number" name="numero_integrantes" id="numero_integrantes">
            </div>

            <!-- Botón de enviar -->
            <button type="submit">Crear evento</button>
          </div>
        </div>

      </form>
    </div>

  </main>

</body>

<script>
  let cropper;

  // Cuando selecciona archivo
  document.getElementById('portada').addEventListener('change', (e) => {
    const archivo = e.target.files[0];
    if (!archivo) return;

    const url = URL.createObjectURL(archivo);
    const img = document.getElementById('cropperImagen');
    img.src = url;

    // Mostrar contenedor del cropper
    document.getElementById('cropperContainer').style.display = 'block';

    // Destruir cropper previo si ya existía
    if (cropper) cropper.destroy();

    // Iniciar cropper con relación 1:1
    img.onload = () => {
      cropper = new Cropper(img, {
        aspectRatio: 1,
        viewMode: 1
      });
    };
  });

  // Cuando se hace clic en recortar
  document.getElementById('btnRecortar').addEventListener('click', () => {
    if (!cropper) return;

    // Generar canvas cuadrado (ejemplo: 400x400)
    const canvas = cropper.getCroppedCanvas({
      width: 400,
      height: 400
    });

    // Mostrar preview final
    const preview = document.getElementById('previewFinal');
    preview.src = canvas.toDataURL('image/png'); // base64 listo para subir
    preview.style.display = 'block';

    // Ocultar cropper luego del recorte
    document.getElementById('cropperContainer').style.display = 'none';

    // (Opcional) guardar blob para enviar al backend
    // canvas.toBlob((blob) => { subir al servidor });
  });
</script>

</html>